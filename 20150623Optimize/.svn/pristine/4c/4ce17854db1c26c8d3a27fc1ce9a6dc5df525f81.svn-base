<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
    <meta name="format-detection" content="telephone=no" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="renderer" content="webkit" />
    <meta http-equiv="pragma" content="no-cache" />
    <meta http-equiv="Cache-Control" content="no-cache, must-revalidate" />
    <meta http-equiv="expires" content="Wed, 26 Feb 1997 08:21:57 GMT" />
    <title>发布抵扣券</title>
<link href="../../tron/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
<link href="../../tron/bootstrap/css/font-awesome.min.css" rel="stylesheet">
    <link href="style.css" rel="stylesheet" />
    <link href="date/css/common.css" rel="stylesheet">
    <script src="../../tron/coms/jquery/jquery-2.1.1/jquery-2.1.1.min.js"></script>
    <script src="../../tron/coms/jquery-plugins/jquery.cookie/jquery.cookie.js"></script>
    <script src="../assets/jquery.form.3.46.0.js"></script>
    <script src="date/js/date.js"></script>
    <script src="date/js/iscroll.js"></script>
    <script src="all.js"></script>
    <script type="text/javascript">
		var qs = {};
      $(function(){
        $('#startTime').date();
        $('#endTime').date();
        
				$('#fx').ajaxForm({
					dataType: 'json',
					beforeSubmit: function(){
					  
					  var isReturn = true;
					  
					  var ipt1 = $('#discountName').val();
            var ipt2 = $('#startTime').val();
            var ipt3 = $('#endTime').val();
            var ipt4 = $('#full').val();
            var ipt5 = $('#return').val();
            var ipt6 = $('#valid').val();
            var ipt7 = $('#num').val();
            var ipt8 = $('#maxNum').val();

            var v5 = parseFloat(ipt5)
            var v8 = parseFloat(ipt8)       

            if(ipt1.length == 0){
              showMask('抵扣券名称不能为空');
              isReturn = false;
            }else if(ipt2.length == 0){
              showMask('活动开始时间不能为空');
              isReturn = false;
            }else if(ipt3.length == 0){
              showMask('活动结束时间不能为空');
              isReturn = false;
            }else if(ipt4.length == 0){
              showMask('活动金额不能为空');
              isReturn = false;
            }else if(ipt5.length == 0){
              showMask('满减金额不能为空');
              isReturn = false;
            }else if(ipt6.length == 0){
              showMask('优惠券有效期不能为空');
              isReturn = false;
            }else if(ipt7.length == 0){
              showMask('数量不能为空');
              isReturn = false;
            }else if(ipt2>ipt3){
              showMask('活动开始时间不能大于结束时间');
              isReturn = false;
            }else if(ipt8 % ipt5!=0){
              showMask('最多抵扣金额须为满减金额的整数倍');
              isReturn = false;
            }else if(v8<v5){
              showMask('最多抵扣金额不能小于满减金额');
              isReturn = false;
            }
            
					  return isReturn;
					  
					},
					success: function(data){
						if ( data.error === 0 ){
						  showMask(data.msg);
						  //跳转会员浏览页面
              var type = 'finish';
              var value = 'vipView.html?s='+qs.s+'&e='+qs.e;
						  if ( inAp ){
                window.location = "message:type:"+type+",value:"+value;
              }
              else if ( inAn ){
                window.redEnvelopeShare.getRecomandTopicsValue('{ "type": "' + type + '", "value": "' + value + '" }');
              }
						}else{
              showMask(data.msg);
						}
					},
					error: function(){
              showMask('网络异常');
					},
				});
				
				var s = window.location.search ? window.location.search.substr(1) : (window.location.href.split('?') > 1 ? window.location.href.split('?')[1] : '');
				s = s.split('&');
				for ( var i = 0 ; i < s.length ; i++ ){
					var d = s[i].split('=');
					qs[d[0]] = d[1];
					$("[name='" + d[0] + "']").val(d[1]);
				}
				
				$("input[name='shopId']").val(qs.s);
        $("input[name='employeeId']").val(qs.e);
				
				var device = getDevices();
        var inWx = navigator.userAgent.match(/MicroMessenger/i); // wei xin
        var inAp = device.iOS; // ios
        var inAn = device.Android; // android
				
        function getDevices() {
          var u = navigator.userAgent, app = navigator.appVersion;
          return {
            trident: u.indexOf('Trident') > -1,
            presto: u.indexOf('Presto') > -1,
            webKit: u.indexOf('AppleWebKit') > -1,
            gecko: u.indexOf('Gecko') > -1 && u.indexOf('KHTML') == -1,
            mobile: !!u.match(/AppleWebKit.*Mobile.*/),
            iOS: !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),
            Android: u.indexOf('Android') > -1 || u.indexOf('Linux') > -1,
            iPhone: u.indexOf('iPhone') > -1,
            iPad: u.indexOf('iPad') > -1,
            webApp: u.indexOf('Safari') == -1
          };
        };
				
      });
    </script>
  </head>
  <body>
      <form action="/Coupon/CouponMsg.aspx?action=coupon_add" method="post" id="fx">
          <input type="hidden" name="shopId" value="" />
          <input type="hidden" name="employeeId" value="" />
          <div class="wrap release">
              <ul>
                  <li id="li1">
                    <table cellpadding="0" cellspacing="0">
                      <tr>
                        <td><span>新建名称</span></td>
                        <td><input type="text" id="discountName" name="couponName" value="" placeholder="" maxlength="15" /></td>
                      </tr>
                    </table>
                  </li>
                  <li id="li2">
                    <table cellpadding="0" cellspacing="0">
                      <tr>
                        <td><span>活动开始日期</span></td>
                        <td><input type="text" id="startTime" name="startDate" value="" placeholder="" /></td>
                      </tr>
                    </table>
                  </li>
                  <li id="li3">
                    <table cellpadding="0" cellspacing="0">
                      <tr>
                        <td><span>活动结束日期</span></td>
                        <td><input type="text" id="endTime" name="endDate" value="" placeholder="" /></td>
                      </tr>
                    </table>
                  </li>
                  <li id="li4">
                    <table cellpadding="0" cellspacing="0">
                      <tr>
                        <td><span>满</span></td>
                        <td><p>￥<input type="number" id="full" name="RequirementMoney" value="" autocomplete="off" placeholder="" onKeyPress="if((event.keyCode<48 || event.keyCode>57) && event.keyCode!=46 || /\.\d\d$/.test(value))event.returnValue=false" /></p></td>
                      </tr>
                    </table>
                  </li>
                  <li id="li5">
                      
                    <table cellpadding="0" cellspacing="0">
                      <tr>
                        <td><span>减</span>
                      </td>
                        <td><p>￥<input type="number" id="return" name="DeductibleAmount" value="" autocomplete="off" placeholder="" onKeyPress="if((event.keyCode<48 || event.keyCode>57) && event.keyCode!=46 || /\.\d\d$/.test(value))event.returnValue=false" /></p></td>
                      </tr>
                    </table>
                  </li>
                  <li>
                      <span>抵扣券有效期</span>
                      <input type="number" class="iptTxtBlue" id="valid" name="ValidityPeriod" autocomplete="off" value="" placeholder="" onkeyup="this.value=this.value.replace(/\D/g,'')" onafterpaste="this.value=this.value.replace(/\D/g,'')" />天
                  </li>
                  <li>
                      <span>数量</span>
                      <input type="number" class="iptTxtBlue" id="num" name="quantity" autocomplete="off" value="" placeholder="" onkeyup="this.value=this.value.replace(/\D/g,'')" onafterpaste="this.value=this.value.replace(/\D/g,'')" />张
                  </li>
                  <li>
                    <span>最多减</span>
                    <input type="number" class="iptTxtBlue" id="maxNum" name="MaxAmount" autocomplete="off" value="" placeholder="" onkeyup="this.value=this.value.replace(/\D/g,'')" onafterpaste="this.value=this.value.replace(/\D/g,'')" />元
                  </li>
              </ul>
              <div class="btnbg">
                  <input type="submit" id="completeBtn" value="完成" />
              </div>
          </div>
          <div id="datePlugin"></div>
      </form>
      <div id="mask">
        <div id="maskTitle">数据提交</div>
      </div>
  </body>
</html>