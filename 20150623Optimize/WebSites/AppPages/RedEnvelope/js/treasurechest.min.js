function redenvelopee(n){this.dev=!!n;this.qs=getQueryStringArgs();this.wx=new wxContext(this,!!n);this.mobile=null;this.retry=!0;this.timer=null;this.init(this.device())}function wxContext(n,t){this.appid="wx3f9ff3043cbcb3b7";this.context=n;this.callbackURL=window.location.href;n.localuri=this.callbackURL;this.oauthCallbackURL=t?encodeURIComponent("http://test.u-xian.com:82/AppPages/weChat/callbackAddress.aspx?from="+encodeURIComponent(this.callbackURL)):encodeURIComponent("http://u-xian.com/AppPages/weChat/callbackAddress.aspx?from="+encodeURIComponent(this.callbackURL));this.jumpURL="https://open.weixin.qq.com/connect/oauth2/authorize?appid="+this.appid+"&redirect_uri="+this.oauthCallbackURL+"&response_type=code&scope=snsapi_userinfo&state="+window.state+"#wechat_redirect";this.shareText="今天又领到悠先红包{0}元，每天累积，吃霸王餐不是梦，哈哈思密哒…";this.shareImg="http://image.u-xian.com/UploadFiles/Images/TreasureChest/weixing_shared.png";this.shareURL=t?"http://test.u-xian.com:82/AppPages/RedEnvelope/TreasureChest.aspx":"http://u-xian.com/AppPages/RedEnvelope/TreasureChest.aspx";lineLink=this.shareURL;imgUrl=this.shareImg;shareTitle="悠先点菜";descContent=this.shareText}function status(n){this.context=n}function getQueryStringArgs(){for(var e=location.search.length>0?location.search.substring(1):"",i={},r=e.split("&"),n=null,u=null,f=null,t=0;t<r.length;t++)n=r[t].split("="),u=decodeURIComponent(n[0]),f=decodeURIComponent(n[1]),i[u]=f;return i}function opentip(n){try{tiptimer&&clearTimeout(tiptimer)}catch(t){}return $("#msgBg,#showMsg").removeClass("hide"),n?($("#showMsg .error").removeClass("hide"),$("#showMsg .numberCurrect").addClass("hide"),$("#showMsg .error").html(n),tiptimer=setTimeout(closetip,2e3)):($("#showMsg .error").addClass("hide"),$("#showMsg .numberCurrect").removeClass("hide")),$("#showMsg").get(0)}function closetip(){try{tiptimer&&clearTimeout(tiptimer)}catch(n){}$("#msgBg,#showMsg").addClass("hide")}function weixinShare(n){$.ajax({url:"/AppPages/ajax/wechatGongzhong.ashx",type:"post",dataType:"json",data:{m:"config",url:n},success:function(n){wx.config({debug:!1,appId:n.appId,timestamp:n.timestamp,nonceStr:n.nonceStr,signature:n.signature,jsApiList:["getNetworkType","checkJsApi","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareWeibo","onMenuShareQQ"]})},error:function(){}});weixinReady()}function weixinReady(n,t,i,r){wx.ready(function(){wx.onMenuShareAppMessage({title:n,desc:t,link:r,imgUrl:i,trigger:function(){},success:function(){},cancel:function(){},fail:function(){}});wx.onMenuShareTimeline({title:t,link:r,imgUrl:i,trigger:function(){},success:function(){},cancel:function(){},fail:function(){}})})}function open_or_download_app(){navigator.userAgent.match(/(iPhone|iPod|iPad);?/i)?window.location="http://a.app.qq.com/o/simple.jsp?pkgname=va.dish.sys":navigator.userAgent.match(/android/i)&&(window.location="http://a.app.qq.com/o/simple.jsp?pkgname=va.dish.sys")}function mask(){navigator.userAgent.match(/MicroMessenger/i)||(navigator.userAgent.match(/(iPhone|iPod|iPad);?/i)?window.location="message:type:0,value:showShareLayout":navigator.userAgent.match(/android/i)&&window.redEnvelopeShare.showShareLayout())}function onBridgeReady(){if(isShowWeiXinShareButton==!0){WeixinJSBridge.on("menu:share:appmessage",function(){shareFriend()});WeixinJSBridge.on("menu:share:timeline",function(){shareTimeline()});WeixinJSBridge.on("menu:share:weibo",function(){shareWeibo()});WeixinJSBridge.call("showOptionMenu")}else WeixinJSBridge.call("hideOptionMenu");setTimeout(function(){$(".mask button").removeClass("button-hui");$(".mask button").unbind("click");$(".mask button").click(function(){$(".mask").hide();$(".main").show()})},0)}function shareFriend(){$(".mask button").removeClass("button-hui");$(".mask button").unbind("click");$(".mask button").click(function(){$(".mask").hide();$(".main").show()});WeixinJSBridge.invoke("sendAppMessage",{appid:appid,img_url:imgUrl,img_width:"640",img_height:"640",link:lineLink,desc:descContent,title:shareTitle},function(n){_report("send_msg",n.err_msg)})}function shareTimeline(){$(".mask button").removeClass("button-hui");$(".mask button").unbind("click");$(".mask button").click(function(){$(".mask").hide();$(".main").show()});WeixinJSBridge.invoke("shareTimeline",{img_url:imgUrl,img_width:"640",img_height:"640",link:lineLink,desc:descContent,title:descContent},function(){})}function shareWeibo(){$(".mask button").removeClass("button-hui");$(".mask button").unbind("click");$(".mask button").click(function(){$(".mask").hide();$(".main").show()});WeixinJSBridge.invoke("shareWeibo",{content:descContent,url:lineLink},function(n){_report("weibo",n.err_msg)})}function weixinShare(){typeof WeixinJSBridge=="undefined"?document.addEventListener?document.addEventListener("WeixinJSBridgeReady",onBridgeReady,!1):document.attachEvent&&(document.attachEvent("WeixinJSBridgeReady",onBridgeReady),document.attachEvent("onWeixinJSBridgeReady",onBridgeReady)):onBridgeReady()}function getJSONForAndroid(){var n=getJSON();window.redEnvelopeShare.getRedenvelopeJson(n)}function getJSON(){return JSON.stringify({content:descContent,imgUrl:imgUrl,shareUrl:lineLink})}var appid="wx3f9ff3043cbcb3b7",lineLink=window.location.protocol+"//"+window.location.host+":81/AppPages/RedEnvelope/TreasureChest.aspx?activityId=",imgUrl="http://image.u-xian.com/UploadFiles/Images/TreasureChest/weixing_shared.png",shareTitle="",descContent="",sharedContents=["今天又领到悠先红包{0}元，每天累积，吃霸王餐不是梦，哈哈思密哒…","今天又领到悠先红包{0}元，每天累积，吃霸王餐不是梦，哈哈思密哒…"],isShowWeiXinShareButton=!1,isShowMask=!1,tiptimer;redenvelopee.prototype.init=function(n){var t=window.navigator.userAgent.match(/MicroMessenger/i),u=n.versions.android,f=n.versions.ios,i=$.cookie("mobilePhoneNumber"),r;this.iswx=t;this.isad=u;this.isio=f;this.qs.mobilephone&&(i=this.qs.mobilephone);t&&(r=this.qs.cookie);this.mobilePhoneNumber=i;this.cookie=r;this.load()};redenvelopee.prototype.bindShare=function(n){var t=n||this.mobilePhoneNumber;$.cookie("mobilePhoneNumber",t,{expires:new Date("3015/01/01 00:00:00"),path:"/"});this.mobilePhoneNumber=t;this.post({m:"shared",redEnvelopeId:this.redEnvelopeId,mobilePhoneNumber:this.mobilePhoneNumber,source:this.qs.source,wx:this.iswx?1:0})};redenvelopee.prototype.bindChange=function(n){var t=this;$.ajax({url:"TreasureChestHandler.ashx",type:"POST",dataType:"json",data:{m:"modify",redEnvelopeId:this.redEnvelopeId,mobilePhoneNumber:n,wx:this.iswx?1:0},success:function(i){i.status==0?($.cookie("mobilePhoneNumber",n,{expires:new Date("3015/01/01 00:00:00"),path:"/"}),t.mobilePhoneNumber=n,$("#changebox span").html(n),$("#change").addClass("hide"),closetip()):opentip("修改失败")}})};redenvelopee.prototype.load=function(){this.post({m:"pageload",activityId:this.qs.activityId,mobilePhoneNumber:this.mobilePhoneNumber,cookie:this.cookie,source:this.qs.source,wx:this.iswx?1:0});this.wx.share();weixinShare()};redenvelopee.prototype.device=function(){return{versions:function(){var n=navigator.userAgent,t=navigator.appVersion;return{trident:n.indexOf("Trident")>-1,presto:n.indexOf("Presto")>-1,webKit:n.indexOf("AppleWebKit")>-1,gecko:n.indexOf("Gecko")>-1&&n.indexOf("KHTML")==-1,mobile:!!n.match(/AppleWebKit.*Mobile.*/)||!!n.match(/AppleWebKit/),ios:!!n.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:n.indexOf("Android")>-1||n.indexOf("Linux")>-1,iPhone:n.indexOf("iPhone")>-1||n.indexOf("Mac")>-1,iPad:n.indexOf("iPad")>-1,webApp:n.indexOf("Safari")==-1}}(),language:(navigator.browserLanguage||navigator.language).toLowerCase()}};redenvelopee.prototype.serverError=function(){$("body").attr("class","status500")};redenvelopee.prototype.beforeSend=function(){opentip("正在发送数据，请稍后...")};redenvelopee.prototype.ajaxCallback=function(n){var r,u,f,t,i;if(closetip(),r=n.status,u=new status(this),n.amount&&(this.amount=n.amount),n.amount&&n.activityType===2&&$(".money").html("<span>"+n.amount+"<\/span>元"),n.redEnvelopeId&&(this.redEnvelopeId=n.redEnvelopeId),n.mobilePhoneNumber&&(this.mobilePhoneNumber=n.mobilePhoneNumber),n.shareText&&(this.wx.shareText=n.shareText),n.shareImage&&(imgUrl=this.wx.shareImg=n.shareImage),n.activityRule&&$("#rule").html(n.activityRule),this.wx.getShareText(n.amount),this.wx.getShareURL(this.qs.activityId,this.mobilePhoneNumber),n.ranklist&&n.ranklist.length)for(f=$("#randlist").empty(),t=0;t<n.ranklist.length;t++)i="<li>",i+='<div class="level level'+(t+1)+' float_right">'+(t+1)+"<\/div>",i+="<span>"+n.ranklist[t].mobilePhoneNumber+"<\/span>",i+='<span class="allGet">累积已领￥'+n.ranklist[t].amount+"<\/span>",i+='<span class="display_block des">'+n.ranklist[t].context+"<\/span>",i+="<\/li>",f.append(i);u[r]?($("body").attr("class","status"+r),u[r].call(u,n)):this.serverError()};redenvelopee.prototype.post=function(n){var i=this.retry,t=this;$.ajax({url:"TreasureChestHandler.ashx",type:"post",dataType:"json",data:n,success:function(n){t.ajaxCallback(n)},error:function(n){t.serverError(n)},beforeSend:function(){t.beforeSend()}})};redenvelopee.prototype.times=function(n,t){var i=this;this.timer=window.setInterval(function(){var u=0,f=0,r=0,e=0;if(n>0)u=Math.floor(n/86400),f=Math.floor(n/3600)-u*24,r=Math.floor(n/60)-u*1440-f*60,e=Math.floor(n)-u*86400-f*3600-r*60;else if(n<0){clearInterval(i.timer);t.call(i);return}r<=9&&(r="0"+r);e<=9&&(e="0"+e);$("#day_show").html(u+"天");$("#hour_show").html(f+"时");$("#minute_show").html(r+"分");$("#second_show").html(e+"秒");u<1?$("#day_show").hide():$("#day_show").show();f<1?$("#hour_show").hide():$("#hour_show").show();r<1?$("#minute_show").hide():$("#minute_show").show();n--},1e3)};wxContext.prototype.getShareURL=function(n,t){lineLink=this.shareURL=this.shareURL+"?activityId="+encodeURIComponent(n)+"&mobile="+t};wxContext.prototype.getShareText=function(n){descContent=this.shareText=this.shareText.replace(/\{0\}/g,n)};wxContext.prototype.share=function(){weixinShare(this.context.localuri);this.ready()};wxContext.prototype.ready=function(){weixinReady("悠先点菜",this.shareText,this.shareImg,this.shareURL);this.isReady=!0};status.prototype["0"]=function(n){if(n.isGet){n.status=1004;this.context.ajaxCallback(n);return}n.mobilePhoneNumber?this.context.bindShare():(n.status=101,this.context.ajaxCallback(n))};status.prototype["2"]=function(){this.context.iswx||$(".dio").addClass("hide")};status.prototype["4"]=function(n){n.status=1004;this.context.ajaxCallback(n)};status.prototype["-6"]=function(){};status.prototype["3"]=function(n){this.context.times(Number(n.totalSeconds),function(){$("#second_show").html("loading...");this.load()})};status.prototype["100"]=function(){window.location.href=this.context.wx.jumpURL};status.prototype["101"]=function(){$(".toGet101").find("input[name='mobilePhone']").val(this.context.mobilePhoneNumber);var n=$("#getRedEnvelopeBtn"),t=n.get(0),i=this;if(!t.installed){n.on("click",function(){var n=$("#mobilePhone").val();if(n.length!==11){opentip("手机号码格式不正确");return}i.context.bindShare(n)});t.installed=!0}};status.prototype["102"]=function(){this.context.serverError()};status.prototype["103"]=function(n){n.context="你已经领过啦~同一设备同一号码只能领取1次哟";n.status=101;this.context.ajaxCallback(n)};status.prototype["1004"]=function(n){var i=$("#change"),r=i.get(0),u=this,t;if($(".money").html(this.context.amount),$("#changebox span").html(this.context.mobilePhoneNumber),n.context&&n.show&&(opentip(n.context),delete n.show),isShowWeiXinShareButton=!0,n.isChange)i.remove();else if(!r.installed){i.on("click",function(){var n=opentip();if(!n.installed){$("#cancel").on("click",function(){closetip()});$("#confirm").on("click",function(){var n=$("#newPhoneNumber").val();if(n.length!==11){opentip("手机号码格式不正确");return}u.context.bindChange(n)});n.installed=!0}});r.installed=!0}if(t=$(".cbtn"),!this.context.iswx&&(this.context.isad||this.context.isio)){t.val("分享拿钱");t.on("click",mask)}else t.on("click",open_or_download_app);this.context.iswx||$(".dio").addClass("hide")};status.prototype["1007"]=function(n){opentip(n.context);n.status=1004;n.show=!0;this.context.ajaxCallback(n)};tiptimer=null;
/*
//# sourceMappingURL=treasurechest.min.js.map
*/