!function(O,Q,K,G){var F,L={drag:true,drop:true,exclude:"",nested:true,vertical:true},B={afterMove:function(S,U,T){},containerPath:"",containerSelector:"ol, ul",distance:0,delay:0,handle:"",itemPath:"",itemSelector:"li",isValidTarget:function(S,T){return true},onCancel:function(S,U,T,V){},onDrag:function(S,U,T,V){S.css(U)},onDragStart:function(S,U,T,V){S.css({height:S.height(),width:S.width()});S.addClass("dragged");O("body").addClass("dragging")},onDrop:function(S,U,T,V){S.removeClass("dragged").removeAttr("style");O("body").removeClass("dragging")},onMousedown:function(S,T,U){if(!U.target.nodeName.match(/^(input|select)$/i)){U.preventDefault();return true}},placeholder:'<li class="placeholder"/>',pullPlaceholder:true,serialize:function(S,V,U){var T=O.extend({},S.data());if(U){return[V]}else{if(V[0]){T.children=V}}delete T.subContainers;delete T.sortable;return T},tolerance:0},R={},J=0,H={left:0,top:0,bottom:0,right:0},F={start:"touchstart.sortable mousedown.sortable",drop:"touchend.sortable touchcancel.sortable mouseup.sortable",drag:"touchmove.sortable mousemove.sortable",scroll:"scroll.sortable"},A="subContainers";function C(V,S){var T=Math.max(0,V[0]-S[0],S[0]-V[1]),U=Math.max(0,V[2]-S[1],S[1]-V[3]);return T+U}function N(T,S,U,Z){var W=T.length,Y=Z?"offset":"position";U=U||0;while(W--){var V=T[W].el?T[W].el:O(T[W]),X=V[Y]();X.left+=parseInt(V.css("margin-left"),10);X.top+=parseInt(V.css("margin-top"),10);S[W]=[X.left-U,X.left+V.outerWidth()+U,X.top-U,X.top+V.outerHeight()+U]}}function M(S,U){var T=U.offset();return{left:S.left-T.left,top:S.top-T.top}}function E(W,T,S){T=[T.left,T.top];S=S&&[S.left,S.top];var X,U=W.length,V=[];while(U--){X=W[U];V[U]=[U,C(X,T),S&&C(X,S)]}V=V.sort(function(Z,Y){return Y[1]-Z[1]||Y[2]-Z[2]||Y[0]-Z[0]});return V}function P(S){this.options=O.extend({},B,S);this.containers=[];if(!this.options.rootGroup){this.scrollProxy=O.proxy(this.scroll,this);this.dragProxy=O.proxy(this.drag,this);this.dropProxy=O.proxy(this.drop,this);this.placeholder=O(this.options.placeholder);if(!S.isValidTarget){this.options.isValidTarget=G}}}P.get=function(S){if(!R[S.group]){if(S.group===G){S.group=J++}R[S.group]=new P(S)}return R[S.group]};P.prototype={dragInit:function(S,T){this.$document=O(T.el[0].ownerDocument);this.item=O(S.target).closest(this.options.itemSelector);this.itemContainer=T;if(this.item.is(this.options.exclude)||!this.options.onMousedown(this.item,B.onMousedown,S)){return}this.setPointer(S);this.toggleListeners("on");this.setupDelayTimer();this.dragInitDone=true},drag:function(T){if(!this.dragging){if(!this.distanceMet(T)||!this.delayMet){return}this.options.onDragStart(this.item,this.itemContainer,B.onDragStart,T);this.item.before(this.placeholder);this.dragging=true}this.setPointer(T);this.options.onDrag(this.item,M(this.pointer,this.item.offsetParent()),B.onDrag,T);var U=T.pageX||T.originalEvent.pageX,V=T.pageY||T.originalEvent.pageY,S=this.sameResultBox,W=this.options.tolerance;if(!S||S.top-W>V||S.bottom+W<V||S.left-W>U||S.right+W<U){if(!this.searchValidTarget()){this.placeholder.detach()}}},drop:function(S){this.toggleListeners("off");this.dragInitDone=false;if(this.dragging){if(this.placeholder.closest("html")[0]){this.placeholder.before(this.item).detach()}else{this.options.onCancel(this.item,this.itemContainer,B.onCancel,S)}this.options.onDrop(this.item,this.getContainer(this.item),B.onDrop,S);this.clearDimensions();this.clearOffsetParent();this.lastAppendedItem=this.sameResultBox=G;this.dragging=false}},searchValidTarget:function(X,T){if(!X){X=this.relativePointer||this.pointer;T=this.lastRelativePointer||this.lastPointer}var Z=E(this.getContainerDimensions(),X,T),V=Z.length;while(V--){var S=Z[V][0],W=Z[V][1];if(!W||this.options.pullPlaceholder){var Y=this.containers[S];if(!Y.disabled){if(!this.$getOffsetParent()){var U=Y.getItemOffsetParent();X=M(X,U);T=M(T,U)}if(Y.searchValidTarget(X,T)){return true}}}}if(this.sameResultBox){this.sameResultBox=G}},movePlaceholder:function(V,U,W,S){var T=this.lastAppendedItem;if(!S&&T&&T[0]===U[0]){return}U[W](this.placeholder);this.lastAppendedItem=U;this.sameResultBox=S;this.options.afterMove(this.placeholder,V,U)},getContainerDimensions:function(){if(!this.containerDimensions){N(this.containers,this.containerDimensions=[],this.options.tolerance,!this.$getOffsetParent())}return this.containerDimensions},getContainer:function(S){return S.closest(this.options.containerSelector).data(K)},$getOffsetParent:function(){if(this.offsetParent===G){var S=this.containers.length-1,T=this.containers[S].getItemOffsetParent();if(!this.options.rootGroup){while(S--){if(T[0]!=this.containers[S].getItemOffsetParent()[0]){T=false;break}}}this.offsetParent=T}return this.offsetParent},setPointer:function(T){var S=this.getPointer(T);if(this.$getOffsetParent()){var U=M(S,this.$getOffsetParent());this.lastRelativePointer=this.relativePointer;this.relativePointer=U}this.lastPointer=this.pointer;this.pointer=S},distanceMet:function(S){var T=this.getPointer(S);return(Math.max(Math.abs(this.pointer.left-T.left),Math.abs(this.pointer.top-T.top))>=this.options.distance)},getPointer:function(S){return{left:S.pageX||S.originalEvent.pageX,top:S.pageY||S.originalEvent.pageY}},setupDelayTimer:function(){var S=this;this.delayMet=!this.options.delay;if(!this.delayMet){clearTimeout(this._mouseDelayTimer);this._mouseDelayTimer=setTimeout(function(){S.delayMet=true},this.options.delay)}},scroll:function(S){this.clearDimensions();this.clearOffsetParent()},toggleListeners:function(T){var S=this,U=["drag","drop","scroll"];O.each(U,function(V,W){S.$document[T](F[W],S[W+"Proxy"])})},clearOffsetParent:function(){this.offsetParent=G},clearDimensions:function(){this.traverse(function(S){S._clearDimensions()})},traverse:function(S){S(this);var T=this.containers.length;while(T--){this.containers[T].traverse(S)}},_clearDimensions:function(){this.containerDimensions=G},_destroy:function(){R[this.options.group]=G}};function I(U,T){this.el=U;this.options=O.extend({},L,T);this.group=P.get(this.options);this.rootGroup=this.options.rootGroup||this.group;this.handle=this.rootGroup.options.handle||this.rootGroup.options.itemSelector;var S=this.rootGroup.options.itemPath;this.target=S?this.el.find(S):this.el;this.target.on(F.start,this.handle,O.proxy(this.dragInit,this));if(this.options.drop){this.group.containers.push(this)}}I.prototype={dragInit:function(S){var T=this.rootGroup;if(!this.disabled&&!T.dragInitDone&&this.options.drag&&this.isValidDrag(S)){T.dragInit(S,this)}},isValidDrag:function(S){return S.which==1||S.type=="touchstart"&&S.originalEvent.touches.length==1},searchValidTarget:function(S,V){var a=E(this.getItemDimensions(),S,V),Z=a.length,W=this.rootGroup,X=!W.options.isValidTarget||W.options.isValidTarget(W.item,this);if(!Z&&X){W.movePlaceholder(this,this.target,"append");return true}else{while(Z--){var T=a[Z][0],Y=a[Z][1];if(!Y&&this.hasChildGroup(T)){var U=this.getContainerGroup(T).searchValidTarget(S,V);if(U){return true}}else{if(X){this.movePlaceholder(T,S);return true}}}}},movePlaceholder:function(V,Y){var e=O(this.items[V]),W=this.itemDimensions[V],b="after",Z=e.outerWidth(),U=e.outerHeight(),a=e.offset(),X={left:a.left,right:a.left+Z,top:a.top,bottom:a.top+U};if(this.options.vertical){var S=(W[2]+W[3])/2,d=Y.top<=S;if(d){b="before";X.bottom-=U/2}else{X.top+=U/2}}else{var c=(W[0]+W[1])/2,T=Y.left<=c;if(T){b="before";X.right-=Z/2}else{X.left+=Z/2}}if(this.hasChildGroup(V)){X=H}this.rootGroup.movePlaceholder(this,e,b,X)},getItemDimensions:function(){if(!this.itemDimensions){this.items=this.$getChildren(this.el,"item").filter(":not(.placeholder, .dragged)").get();N(this.items,this.itemDimensions=[],this.options.tolerance)}return this.itemDimensions},getItemOffsetParent:function(){var T,S=this.el;if(S.css("position")==="relative"||S.css("position")==="absolute"||S.css("position")==="fixed"){T=S}else{T=S.offsetParent()}return T},hasChildGroup:function(S){return this.options.nested&&this.getContainerGroup(S)},getContainerGroup:function(V){var U=O.data(this.items[V],A);if(U===G){var T=this.$getChildren(this.items[V],"container");U=false;if(T[0]){var S=O.extend({},this.options,{rootGroup:this.rootGroup,group:J++});U=T[K](S).data(K).group}O.data(this.items[V],A,U)}return U},$getChildren:function(V,S){var T=this.rootGroup.options,W=T[S+"Path"],U=T[S+"Selector"];V=O(V);if(W){V=V.find(W)}return V.children(U)},_serialize:function(U,S){var T=this,V=S?"item":"container",W=this.$getChildren(U,V).not(this.options.exclude).map(function(){return T._serialize(O(this),!S)}).get();return this.rootGroup.options.serialize(U,W,S)},traverse:function(S){O.each(this.items||[],function(U){var T=O.data(this,A);if(T){T.traverse(S)}});S(this)},_clearDimensions:function(){this.itemDimensions=G},_destroy:function(){var S=this;this.target.off(F.start,this.handle);this.el.removeData(K);if(this.options.drop){this.group.containers=O.grep(this.group.containers,function(T){return T!=S})}O.each(this.items||[],function(){O.removeData(this,A)})}};var D={enable:function(){this.traverse(function(S){S.disabled=false})},disable:function(){this.traverse(function(S){S.disabled=true})},serialize:function(){return this._serialize(this.el,true)},refresh:function(){this.traverse(function(S){S._clearDimensions()})},destroy:function(){this.traverse(function(S){S._destroy()})}};O.extend(I.prototype,D);O.fn[K]=function(S){var T=Array.prototype.slice.call(arguments,1);return this.map(function(){var V=O(this),U=V.data(K);if(U&&D[S]){return D[S].apply(U,T)||this}else{if(!U&&(S===G||typeof S==="object")){V.data(K,new I(V,S))}}return this})}}(jQuery,window,"sortable");